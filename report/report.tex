\documentclass{article}
\usepackage{xcolor}
\usepackage{graphicx} % For including images
\usepackage{amsmath} % For mathematical symbols and equations
\usepackage{hyperref} % For hyperlinks
\usepackage{listings} % For including code snippets
\usepackage{amssymb}
\usepackage[a4paper, total={6in, 9.5in}]{geometry}

\title{Projet Linux}
\author{VANGEEBERGEN Augustin}

\date{\today}
\renewcommand \contentsname{Table des matières}
\begin{document}
	
	\maketitle
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.5\textwidth]{logo.png}
		\label{fig:logoheh}
	\end{figure}
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\textwidth]{Gold\_AlmaLinux.jpg}
		\label{fig:logoheh}
	\end{figure}
	

	
	\newpage


	\tableofcontents
	\newpage
	

	
\section{Introduction}
Dans le cadre de ce projet, l'objectif est de configurer un serveur GNU/Linux. Cet exercice consiste à mettre en application la matière vue en classe, et à se préparer à un environnement réel.
	
Les objectifs globaux sont donc l'application et la compréhension profonde des mécanismes permettant d'héberger les différents services souhaités, de la gestion des utilisateurs, ainsi que de la sécurité, que ce soit au niveau des attaques ou des sauvegardes.

Nous avons le choix d'utiliser n'importe quelle distributon RedHat-like, par exemple Fedora, ou bien Alma, sur laquelle nous avons travaillé en cours.
Le choix se porte sur Fedora, qui a une plus grosse communauté (dont je fais partie pour la partie desktop) et a ma préférence (utiliser alma ne changerait bien sûr quasiment rien, les deux distributions étant très similaires).

Dans la deuxième itération de ce projet linux, la barre est automatiquement mise plus haut.
	
Les consignes professeur sont toujours les mêmes, et sont reprises dans le sous-point suivant. Cependant, je souhaite faire tourner un serveur php pour mon homelab (et ainsi faire d'une pierre deux coups). L'option est donc présente en supplément.
	
L'OS de test est une machine virtuelle, hébergée sur VirtualBox. 
	
	Le but est aussi de pouvoir gérer en ssh le serveur avec plein d'outils utiles, et de pouvoir installer/désinstaller les services à souhait, diminuant ainsi la surface d'attaque.
	
	Nous devons donc gérer des services de partage de fichiers, serveur DNS, serveur Web ainsi que serveur temps.
	
	La dernière étape sera de sécuriser le serveur correctement, notamment en utilisant SELinux, et en définissant les polices d'utilisation correctes.
	
\begin{center}linux meme (19 juillet 2024) :
\end{center}
\begin{figure}[h]
\centering
\includegraphics[width=1\textwidth]{meme.png}
\label{fig:meme}
\end{figure}
\newpage
	
\subsection{Consignes (pratiques) professeur}
	
Les consignes sont les suivantes : 
	
\begin{itemize}
\item Chaque groupe devra mettre en place un serveur linux selon les règles de l’art et devra respecter les bonnes méthodologies pour le faire.
\item Le serveur devra permettre de partager un dossier sans authentification aussi bien pour l’environnement Linux que Windows à l’aide de NFS et Samba.
\item Une connexion SSH judicieusement sécurisée permettra à l’administrateur de configurer le serveur et d’exécuter des scripts sur le serveur.
\item Le serveur devra permettre la mise à disposition pour un client : d’un nom de domaine dans notre domaine, d’un serveur web, d’un accès FTP et Samba à son dossier web et d’une base de données différente pour chaque utilisateur. Le tout devra être automatisé à l’aide de scripts de configurations. Bien sûr chaque client aura un dossier web, une base de données et un domaine différent.
\item En bonus, chaque utilisateur devra posséder une adresse mail dans notre domaine ainsi qu’une interface web pour consulter ses mails.
\item Le serveur de domaine devra également faire cache pour les requêtes, être maitre dans sa zone et également posséder une zone inverse.
\item Le serveur devra permettre aux ordinateurs de son réseau de pouvoir mettre à jour l’heure de leurs machines.
\item Le plan de sauvegarde établi devra être mis en place.
\item Une attention particulière sera portée sur la sécurisation du serveur et des services à l’aide des outils disponibles. (FW, antivirus, SELinux, …)
\item Toutes les installations et configurations seront notées dans le journal de bord de votre serveur.
		
\end{itemize}
	
\newpage	
	
\subsection{Roadmap}
L'ensemble sera scripté pour coller à l'ensemble des cas d'utilisation. Voici donc la liste prévue de ces scripts (pour installer/désinstaller):
\begin{itemize}
\item Menu de sélection
\item SSH config wizard
			\item File sharing install wizard
			\item Web server install wizard
			\item FTP server install wizard
			\item MySQL server 
			\item DNS server (+ cache + création de zone + serveur cache)
			\item Time server
			\item Sécurisation
			\item Backup
			\item Updates
			\item Partitionnement
		\end{itemize}
		Il est donc indispensable de se former au BASH, afin de savoir faire un bon TUI, ainsi que des commandes conditionnelles, selon les features qui sont/ne sont pas déjà installées.
		
		Le service SSH est indépendant des autres services. Le DNS, time server également.
		
		Cependant, les Serveurs Web, SQL et FTP doivent fonctionner en symbiose. C'est aussi le cas du NFS et SMB. Ce sera donc une personne qui s'occupera de ces services deux à deux.
	
\pagebreak

\section{Avant de commencer}
	
\subsection{Hosting}
	
Hyper-V n'ayant pas apporté satisfaction (principalements bugs de corruption de checkpoints), je me suis tourné vers d'autres alternatives :
\begin{itemize}
\item Gnome boxes qui offre peu de flexibilité au niveau du réseau
\item VMware Workstation qui a cassé lors d'une mise à jour du kernel de la machine hôte (Fedora 39 vers Fedora 40)
\end{itemize}
La seule solution correcte restante étant donc Oracle VirtualBox.
	
Virtualbox permet en outre d'associer un ou plusieurs disques virtuels à une machine virtuelle, ce qui est plutôt intéressant au vu du contexte, nous y viendrons dans la sous-section suivante.	
	
\subsection{Partitionnement et RAID}

Il est assez compliqué de séparer le partitionnement et la gestion des disques en deux sous sections, car ces deux concepts sont intimement liés.

Il faut premièrement assurer la préservation des données, dans n'importe quel scénario. 

Il faut également s'assurer que la hiérarchie du stockage a du sens et qu'elle est pratique. 

Sur la machine virtuelle, il y aura :

\begin{itemize}
\item sur un disque, le système d'exploitation contenant les partitions suivantes :
\begin{itemize}
\item /boot
\item /swap
\item /
\item /home
\end{itemize}
\item sur un autre disque, ou plutôt un array de disques en RAID :
\begin{itemize}
\item /share
\item /web
\end{itemize}
\item et enfin, sur un ou plusieurs disque(s) additionnel(s) :
\begin{itemize}
\item /backup
\end{itemize}
\end{itemize}
	
	Petite liste des niveaux de RAID (redundant array of independent disks) les plus courants :
	\begin{itemize}
	\item RAID 0 : volume agrégé par bandes (ou striping).
	
	Perfermances en lecture et écriture extrêmement élevées (jusqu'à n fois pour un nombre n de disques en lecture et écriture), mais aucune redondance, et donc non pertinent pour notre serveur.
	\item RAID 1 : volumes miroirs. 
	
	Meilleure redondance des informations (n-1 disques peuvent être retirés). Pire performance niveau vitesse d'écriture (égale a la vitesse d'écriture d'un disque seul) et vitesse de lecture jusqu'à la somme de la vitesse de chaque disque dans l'array (meilleur scénario). Choix rejeté car en pratique on recherche un milieu entre performance et sécurité/redondance.

	\item RAID 5 : volume agrégé par bandes à parité répartie.

	Si un disque lâche, il suffit de remplacer celui-ci, et il peut être reconstitué à partir des autres diques et de la parité stockée sur ceux-ci.

	\end{itemize}

Le choix va se porter sur le RAID 5, qui combine performance et efficacité, en offrant une sécurité sur la casse d'un disque à la fois. On peut donc finir la liste des disques vituels :
\begin{itemize}
\item 1 disque pour l'OS et les fichiers de configuration (disk1)
\item 3 disques (c'est à dire le minimum requis pour un RAID 5) pour le stockage (disk2-3-4)
\item 1 disque pour la sauvegarde (disk5)
\end{itemize}

\newpage

\subsection{VirtualBox}

Comme dit précédemment, voici les différents diques virtuels créés et leur taille, dans l'interface de VirtualBox :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox1.png}
\end{figure}

Ensuite, il faut créer la machine virtuelle, en prenant soin de selectionner le bon ISO :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox2.png}
\end{figure}

\newpage

On sélectionne la quantité de ram optimale pour le système :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox3.png}
\end{figure}

Et on selectionne le disque virtuel créé précedemment :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox4.png}
\end{figure}

Et cliquer sur Finish ou Terminer.

\pagebreak

Pour lancer la machine virtuelle, il suffit de double-cliquer sur le nom de la machine, dans le côté gauche : 

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox5.png}
\end{figure}

On installe en Anglais, parce que c'est la langue universelle et la seule utilisée en programmation.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox6.png}
\end{figure}

\pagebreak
On sélectionne "Continue", et on arrive sur le menu principal d'installation :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox7.png}
\end{figure}

Le clavier est correctement configuré, puisque c'est une machine virtuelle.
La langue est également correctement configurée, ainsi que la date qui dépend de ma machine hôte.
Nous allons aller sélectionner le software dont on a besoin.
Dans notre cas, nous pouvons conserver la Server Edition.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox8.png}
\end{figure}
\pagebreak

On sélectionne une installation custom :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox9.png}
\end{figure}

Puis on crée automatiquement les partitions de base.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox10.png}
\end{figure}

\pagebreak
On ne touche pas à la partion automatique : 

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox11.png}
\end{figure}

 On rajoute les éléments manquants swap (20\% de la RAM) et le /home puisqu'on a un utilisateur dont il faut stocker les données) :
\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox12.png}
\end{figure}

\pagebreak

Ensuite on valide les changements :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox13.png}
\end{figure}


Je choisis personnellement d'avoir un compte root au cas où, mais il n'est pas conseillé en production.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox14.png}
\end{figure}

\pagebreak

Ensuite, on crée un utilisateur a (admin), avec pour l'exemple, le mot de passe a. Il est non-sécurisé mais facile et rapide à taper.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox15.png}
\end{figure}

Une fois que tous les paramètres ont été réglés, il suffit de lancer l'installation, puis redémarrer la machine virtuelle (Begin Installation).

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox16.png}
\end{figure}

\pagebreak

\subsection{Réseau}

Par défaut, le réseau virtuel sur lequel se trouve la machine est le NAT. Il est donc inaccessible depuis l'extérieur.

Il faut donc aller dans "Devices" \textrightarrow "Network" \textrightarrow "Network Settings", et changer le "Attached To" en "Bridged".


\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox17.png}
\end{figure}

Lorsqu'on lance la machine, on peut voir que son adresse n'est pas 10.10.etc mais bien 192.168.etc, et que l'on est bien en bridge mode. (De plus, ma machine hôte n'a pas la même adresse.)

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox18.png}
\end{figure}

\pagebreak

\subsection{Changer le layout clavier}

On utilise "localectl list-keymaps" pour avoir la liste des layouts disponibles.

Pour sélectionner un layout, par exemple, le "fr" : "localectl set-keymap fr"



\subsection{Snapshots de la machine}

Pour faire une sauvegarde de l'état de la machine, il suffit de sélectionner la machine, puis de cliquer sur "Take" pour créer un snapshot.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox19.png}
\end{figure}

\subsection{Ajout des disques virtuels}

Dans les details de la machine, on selectionne "Storage" :

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox20.png}
\end{figure}


\pagebreak

On va choisir "Add Attachment", "Hard Disk", puis sélectionner un à un les disques pré-créés.

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox21.png}
\end{figure}

And voilà ! (Je laisse le disque de backup en attente pour pouvoir identifier facilement les disques à mettre en RAID. Il suffit de répéter cette étape pour le disque de backup)

\begin{figure}[h!]
		\centering
		\includegraphics[width=1\textwidth]{vbox22.png}
\end{figure}


\pagebreak


\pagebreak

\section{Description du logiciel}

\subsection{Clonage du repo git}

git clone https://github.com/trifoil/School-LINUX-PROJECT.git


\subsection{Menu principal}

Pour lancer le script, il suffit de se rendre dans le directory School-LINUX-PROJEC, et d'exécuter le script intitulé "install.sh" en sudo.

\subsection{RAID}

	\colorbox{yellow}{\textcolor{red}{!! A finir}}
	

Les volumes dans lesquels viennent se mettre les partages et fichiers web sont \texttt{/mnt/raid5\_share} et \texttt{/mnt/raid5\_web}.

\subsection{Partage sans authentification}

Le partage sans authentification, donc avec accès libre en écriture et lecture, doit être accessible depuis Linuw et Windows. NFS sera donc utilisé pour linux et Samba pour Windows. 

Le script offre la possibilité de créer un dossier dans le chemin préétabli, ou de choisir le chemin. Il offre aussi la possibilité de créer séparément un partage NFS et un partage SMB. Il gère également les autorisations pour que SELinux autororise l'accès.

\colorbox{yellow}{\textcolor{red}{!! Ajouter limites de poids du dossier}}

Pour monter le directory en NFS :

\texttt{sudo mount -t nfs 192.168.1.195:/mnt/raid5\_share/unauth\_share /mnt}

Pour démonter le directory en NFS :

\texttt{sudo umount /mnt}


\subsection{Connexion par SSH}
\subsection{Gestion des utilisateurs}

De loin la partie la plus difficile, qui comporte plusieurs parties :
\begin{itemize}
\item Mise en place du DNS local
\item Installation de la DB
\item Installation du serveur mail
\item Ajout d'un utilisateur
\begin{itemize}
\item Creation de son dossier web
\item Creation de sa base de données
\item Creation de sa configuration web (http et php)
\item Creation de sa zone dans le DNS et ajout de son sous-domaine
\item Ajout du mail
\end{itemize}
\end{itemize}

\subsection{Serveur temps}
\subsection{Plan de sauvegarde}
\subsection{Sécurité}
\subsection{Journal de bord}

\pagebreak

	\newpage
	\section{Conclusion}


	\begin{figure}[h]
		\centering
		\includegraphics[width=0.5\textwidth]{gosling.png}
		
		\label{fig:gosling}
	\end{figure}
	

	\begin{thebibliography}{9}
		\bibitem{reference1}
		Author, A. (Year). Title of the article. \textit{Journal Name}, Volume(Issue), Pages.
		
		\bibitem{reference2}
		Raid sous Oracle VirtualBox 
		https://youtu.be/ZHVmGfteHCg
	\end{thebibliography}

	\section*{Remerciements}
	
	Remerciements à Pauline M. pour ses encouragement et son aide à la concentration :)

\end{document}
